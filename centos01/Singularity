Bootstrap:docker
#From:centos:7.5.1804
#MirrorURL: registry.suse.com/suse/sle15:latest
#https://build.opensuse.org/package/show/opensuse:leap:15.2:Images/opensuse-leap-image
# installs, but bad language fonts on GUI?  registry.opensuse.org/opensuse/leap:latest
From: registry.opensuse.org/opensuse/leap:15.3
#From: registry.opensuse.org/opensuse/tumbleweed:latest
#docker pull registry.opensuse.org/opensuse/leap:latest
#docker pull registry.suse.com/suse/sle15:latest

%labels
MAINTAINER singular55

%environment
	LANG=C.UTF-8
	PATH=/bin_override:$PATH
	LIBRARY_PATH=/lib_override:$LIBRARY_PATH
	LD_LIBRARY_PATH=/lib_override:$LD_LIBRARY_PATH
	WORKDIR=/work
	export LANG PATH LIBRARY_PATH LD_LIBRARY_PATH WORKDIR

%setup
	mkdir -p $SINGULARITY_ROOTFS/lib_override
	mkdir -p $SINGULARITY_ROOTFS/bin_override
	mkdir -p $SINGULARITY_ROOTFS/work

	#wget http://ftp.osuosl.org/pub/eclipse/technology/epp/downloads/release/2019-09/R/eclipse-jee-2019-09-R-linux-gtk-x86_64.tar.gz -O /tmp/eclipse.tar.gz
	#tar -xf /tmp/eclipse.tar.gz -C $SINGULARITY_ROOTFS/bin_override
	#rm /tmp/eclipse.tar.gz

	#cp eclipse.ini $SINGULARITY_ROOTFS/bin_override/eclipse/

%post
	#yum -y install epel-release	
	#yum repolist
	#yum install -y git meld wget

	#SUSEConnect -p PackageHub/15.3/x86_64 

	#zypper addrepo http://download.opensuse.org/repositories/home:/namtrac:/subpixel/openSUSE_Factory.repo
	#zypper install libfreetype6 libfreetype6-32bit

	# meld kdiff3 firefox gedit SUSE-SLE-Module-Development-Tools
	zypper --non-interactive install git wget firefox meld gedit kdiff3 gnome-desktop google-croscore-fonts iso-codes breeze5-icons

# kdiff3 complains for 'Icon theme breeeze not found', add package breeze5-icons to try and fix
# see some errors for /run/user/xxxx not found on HPC
# iso-codes  (error thrown by gedit on HPC, try to fix with this package)
# works for getting firefox and meld fonts to work!  (so does google-croscore-fonts)
#fetchmsttfonts 
# microsoft-consolas-fonts

	#fix some X / DBus issues?
	#dbus-uuidgen > /var/lib/dbus/machine-id

	#eclipse jee

	


%files
	eclipse.ini eclipse.ini

%runscript
	exec /bin/echo "Hi there, container runscript!"

%apprun meld
	exec meld "$@"

%apprun eclipse
	exec /bin_override/eclipse/eclipse "$@"

%apprun firefox
	exec firefox "$@"

%apprun kdiff3
	exec kdiff3 "$@"

%apprun gedit
	exec gedit "$@"



